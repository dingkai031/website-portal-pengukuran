<%- include("templateP3k/head") %>
<div class="card shadow mx-3 mt-3">
  <div class="card-header">
    <h4 class="card-title my-3">Data Kecelakaan di Bengkel dan Laboratorium Politeknik Perkapalan Negeri Surabaya</h4>
  </div>
  <div class="card-body">
    <div class="row justify-content-center mb-3">
      <div class="col-sm-5 col-md-4 col-lg-3 col-xl-2">
        <div class="text-center">
          <label for="tahun" class="form-label fs-5 text-uppercase"
            >Tahun</label
          >
          <select name="tahun" id="tahun" class="form-select">
            <% let currentYear %> 
            <% if (!tahun) {%>
              <% currentYear = arrayOfYear.slice(-1) %>  
            <% }else {%>
              <% currentYear = tahun %>   
            <% } %> 
            <% for (const year of arrayOfYear) { %>
              <option value="<%= year %>" <%=  parseInt(year) === parseInt(currentYear) ? "selected" : "" %> ><%= year %></option>
            <% } %>
          </select>
        </div>
      </div>
    </div>
    <canvas id="dataKecelakaan" class="w-100" height="500px"></canvas>
  </div>
</div>
<%- include("templateP3k/footer") %>

<script>
  const temp = `<%- JSON.stringify(jumlahLaporan) %>`;
  const jumlahLaporan = JSON.parse(temp);
  const ctx = document.querySelector("#dataKecelakaan");
  const myChart = new Chart(ctx, {
    type: "bar",
    data: {
      labels: [
        "Januari",
        "Februari",
        "Maret",
        "April",
        "Mei",
        "Juni",
        "Juli",
        "Agustus",
        "September",
        "Oktober",
        "November",
        "Desember",
      ],
      datasets: [
        {
          label: "Jumlah Laporan Kecelakaan",
          data: [
            jumlahLaporan.jan,
            jumlahLaporan.feb,
            jumlahLaporan.mar,
            jumlahLaporan.apr,
            jumlahLaporan.mei,
            jumlahLaporan.jun,
            jumlahLaporan.jul,
            jumlahLaporan.agu,
            jumlahLaporan.sep,
            jumlahLaporan.okt,
            jumlahLaporan.nov,
            jumlahLaporan.des,
          ],
          backgroundColor: ["rgba(255, 99, 132, 0.2)"],
          borderColor: ["rgba(255, 99, 132, 1)"],
          borderWidth: 4,
        },
      ],
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
        },
      },
      responsive: true,
    },
  });
</script>

<script>
  const tahun = document.querySelector("#tahun");
  tahun.addEventListener("change", (e) => {
    window.location.replace(`/upik3?tahun=${e.target.value}`);
  });
</script>
