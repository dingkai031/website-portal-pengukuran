<%- include("templateP3k/head") %>
<div class="card shadow mt-3 mx-3">
  <div class="card-header">
    <h3 class="card-title fw-bolder text-capitalize m-0">
      Data Laporan Pemulihan Alat Evakuasi
    </h3>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table
        class="table table-bordered hover align-middle"
        id="tableLaporanAlatEvakuasi"
      >
        <thead>
          <tr>
            <th class="text-center">No</th>
            <th>Tanggal Inspeksi</th>
            <th class="text-center">Data</th>
            <th>Inspektor</th>
            <th class="text-center">Action</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <% for( const laporan of laporans) { %>
          <tr class="text-nowrap">
            <td class="text-center"></td>
            <td>
              <%=
              `${("0"+laporan.tanggalInspeksi.getDate()).slice(-2)}-${("0"+(laporan.tanggalInspeksi.getMonth()+1)).slice(-2)}-${laporan.tanggalInspeksi.getFullYear()}`
              %>
            </td>
            <td class="text-center">
              <div class="modal fade" id="data<%= laporan._id %>" tabindex="-1">
                <div class="modal-dialog modal-xl modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">Data Laporan Alat Evakuasi Korban</h5>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                      ></button>
                    </div>
                    <div class="modal-body">
                        <div class="table-responsive">
                            <table
                            class="table table-bordered text-start mb-0"
                            >
                            <tbody>
                                <tr>
                                    <td class="w-50">
                                      <label for="tanggal" class="form-label fw-bolder"
                                          >1. Tanggal Inspeksi :</label
                                      >
                                      <input type="text" readonly class="form-control"
                                      id="tanggal" value="<%=
                                      `${("0"+laporan.tanggalInspeksi.getDate()).slice(-2)}-${("0"+(laporan.tanggalInspeksi.getMonth()+1)).slice(-2)}-${laporan.tanggalInspeksi.getFullYear()}`
                                      %>">
                                    </td>
                                    <td class="w-50">
                                      <label for="namaKorban" class="form-label fw-bolder"
                                          >2. Nama Inspektor :</label
                                      >
                                      <input
                                          type="text"
                                          readonly
                                          class="form-control"
                                          id="namaKorban"
                                          value="<%= laporan.inspektor.nama %>"
                                      />
                                    </td>
                                </tr>
                               
                                <tr>
                                  <td>
                                    <label for="nip" class="form-label fw-bolder"
                                        >3. NRP/NIP :</label
                                    >
                                    <input
                                        type="text"
                                        readonly
                                        class="form-control"
                                        id="nip"
                                        value="<%= laporan.inspektor.nip %>"
                                    />
                                  </td>
                                  <td>
                                    <label for="nip" class="form-label fw-bolder"
                                        >4. Tempat Inspeksi</label
                                    >
                                    <input
                                        type="text"
                                        readonly
                                        class="form-control"
                                        id="nip"
                                        value="<%= laporan.tempatInspeksi %>"
                                    />
                                  </td>
                                </tr>

                            </tbody>
                            </table>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th
                                        colspan="3"
                                        class="
                                            text-start text-uppercase
                                            fw-bolder
                                            fs-5
                                        "
                                        >
                                            Dokumentasi saat Inspeksi
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="align-middle">
                                      <td style="width: 33%;">
                                          <img src="/img/dokumentasiInspeksi/pelaporanPemulihan/<%= laporan.dokumentasi[0] %>" alt="" class="img-fluid">
                                      </td>
                                      <td style="width: 33%;">
                                          <img src="/img/dokumentasiInspeksi/pelaporanPemulihan/<%= laporan.dokumentasi[1] %>" alt="" class="img-fluid">
                                      </td>
                                      <td style="width: 33%;">
                                          <img src="/img/dokumentasiInspeksi/pelaporanPemulihan/<%= laporan.dokumentasi[2] %>" alt="" class="img-fluid">
                                      </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                  </div>
                </div>
              </div>
              <button
                data-bs-toggle="modal"
                data-bs-target="#data<%= laporan._id %>"
                class="btn btn-primary"
              >
                Data
              </button>
            </td>
            <td><%= laporan.inspektor.nama %></td>
            <td class="text-center">
              <button class="btn btn-primary py-2 px-3">
                <i class="far fa-edit fs-5"></i>
              </button>
              <form
                action="/upik3/data-laporan-pemulihan-alat-evakuasi?_method=DELETE"
                method="POST"
                class="d-inline-block"
              >
                <input
                  class="d-none"
                  type="text"
                  name="idLaporan"
                  readonly
                  value="<%= laporan._id %>"
                />
                <button type="submit" class="btn btn-danger py-2 px-3">
                  <i class="far fa-trash-alt fs-5"></i>
                </button>
              </form>
              <button class="btn btn-secondary py-2 px-3">
                <i class="fas fa-file-download fs-5"></i>
              </button>
            </td>
            <td class="text-center">
              <form action="/upik3/data-laporan-pemulihan-alat-evakuasi?_method=PUT"
              method="POST"
              class="d-inline-block"
              >
                <input
                  class="d-none"
                  type="text"
                  readonly
                  name="idLaporan"
                  value="<%= laporan._id %>"
                />
                
                <button type="<%= !laporan.validasi.status && (currentUser.lokasi === laporan.lokasiP3k || currentUser.lokasi === "semua") ? "submit" : "button" %>" class="btn <%= laporan.validasi.status ? "btn-success" : "btn-danger" %>">
                  <%= laporan.validasi.status ? `Approved By ${laporan.validasi.user.nama}` : "Not Approved" %> 
                </button>
              </form>
            </td>
          </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>
<%- include("templateP3k/footer") %>
