<%- include("templateP3k/head") %>
<div class="card shadow mt-3 mx-3">
  <div class="card-header">
    <h3 class="card-title fw-bolder text-capitalize m-0">
      Data Laporan Kotak P3k
    </h3>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table
        class="table table-bordered hover align-middle"
        id="tableLaporanKecelakaan"
      >
        <thead>
          <tr>
            <th class="text-center">No</th>
            <th>Tanggal Inspeksi</th>
            <th class="text-center">Data</th>
            <th>Lokasi Kotak P3K</th>
            <th>Jenis Kotak P3K</th>
            <th>Inspektor</th>
            <th class="text-center">Action</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <% for( const laporan of laporans) { %>
          <tr class="text-nowrap">
            <td class="text-center"></td>
            <td>
              <%=
              `${("0"+laporan.tanggalInspeksi.getDate()).slice(-2)}-${("0"+(laporan.tanggalInspeksi.getMonth()+1)).slice(-2)}-${laporan.tanggalInspeksi.getFullYear()}`
              %>
            </td>
            <td class="text-center">
              <div class="modal fade" id="data<%= laporan._id %>" tabindex="-1">
                <div class="modal-dialog modal-xl modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">Data Laporan Kota P3k</h5>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                      ></button>
                    </div>
                    <div class="modal-body">
                        <div class="table-responsive">
                            <table
                            class="table table-bordered text-start mb-0"
                            >
                            <tbody>
                                <tr>
                                    <td class="w-50">
                                    <label for="tanggal" class="form-label fw-bolder"
                                        >1. Tanggal Inspeksi :</label
                                    >
                                    <input type="text" readonly class="form-control fw-bolder"
                                    id="tanggal" value="<%=
                                    `${("0"+laporan.tanggalInspeksi.getDate()).slice(-2)}-${("0"+(laporan.tanggalInspeksi.getMonth()+1)).slice(-2)}-${laporan.tanggalInspeksi.getFullYear()}`
                                    %>">
                                    </td>
                                    <td class="w-50">
                                    <label for="namaKorban" class="form-label fw-bolder"
                                        >2. Nama Inspektor :</label
                                    >
                                    <input
                                        type="text"
                                        readonly
                                        class="form-control"
                                        id="namaKorban"
                                        value="<%= laporan.inspektor.nama %>"
                                    />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                    <label for="nip" class="form-label fw-bolder"
                                        >3. NRP/NIP :</label
                                    >
                                    <input
                                        type="text"
                                        readonly
                                        class="form-control"
                                        id="nip"
                                        value="<%= laporan.inspektor.nip %>"
                                    />
                                    </td>
                                    <td>
                                    <label for="lokasiP3k" class="form-label fw-bolder text-wrap"
                                        >4. Letak Kotak P3K yang Sedang Diinspeksi :</label
                                    >
                                    <input
                                        type="text"
                                        readonly
                                        class="form-control"
                                        id="lokasiP3k"
                                        value="<%= laporan.lokasiP3k %>"
                                    />
                                    </td>
                                </tr>
                                <tr>
                                    <td
                                    colspan="2"
                                    class="
                                        text-start text-uppercase
                                        fw-bolder
                                        fs-5
                                        w-50
                                    "
                                    >
                                    ISI KOTAK P3K
                                    </td>
                                </tr>
                            </tbody>
                            </table>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-bordered  w-100 mb-0">
                                <thead  class="align-middle">
                                    <tr>
                                        <th rowspan="2">No</th>
                                        <th rowspan="2">Nama</th>
                                        <th colspan="2">Jumlah</th>
                                    </tr>
                                    <tr>
                                        <th>Jumlah yang Tersedia</th>
                                        <th>Jumlah Maksimal</th>
                                    </tr>
                                </thead>
                                <tbody  class="align-middle">
                                    <tr>
                                        <td class="text-center">1</td>
                                        <td>Kasa Steril Terbungkus</td>
                                        <td><%= laporan.kasaSteril %></td>
                                        <td>40</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">2</td>
                                        <td>Perban (lebar 5 cm)</td>
                                        <td><%= laporan.perban5Cm %></td>
                                        <td>4</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">3</td>
                                        <td>Perban (lebar 10 cm)</td>
                                        <td><%= laporan.perban10Cm %></td>
                                        <td>4</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">4</td>
                                        <td>Plester (lebar 1,25 cm)</td>
                                        <td><%= laporan.plesterBiasa %></td>
                                        <td>4</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">5</td>
                                        <td>Plester Cepat</td>
                                        <td><%= laporan.plesterCepat %></td>
                                        <td>15</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">6</td>
                                        <td>Kapas (25 gram)</td>
                                        <td><%= laporan.kapas %></td>
                                        <td>2</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">7</td>
                                        <td>Kain segitiga/mittela</td>
                                        <td><%= laporan.kainSegitiga %></td>
                                        <td>4</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">8</td>
                                        <td>Gunting</td>
                                        <td><%= laporan.gunting %></td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">9</td>
                                        <td>Peniti</td>
                                        <td><%= laporan.peniti %></td>
                                        <td>12</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">10</td>
                                        <td>Sarung tangan sekali pakai</td>
                                        <td><%= laporan.sarungTangan %></td>
                                        <td>3</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">11</td>
                                        <td>Masker</td>
                                        <td><%= laporan.masker %></td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">12</td>
                                        <td>Pinset</td>
                                        <td><%= laporan.pinset %></td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">13</td>
                                        <td>Lampu Senter</td>
                                        <td><%= laporan.lampuSenter %></td>
                                        <td>2</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">14</td>
                                        <td>Gelas untuk cuci mata</td>
                                        <td><%= laporan.gelasCuciMata %></td>
                                        <td>2</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">15</td>
                                        <td>Kantong Plastik Bersih</td>
                                        <td><%= laporan.kantongPlastik %></td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">16</td>
                                        <td>Aquades (100 ml Iar. Saline)</td>
                                        <td><%= laporan.aquades %></td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">17</td>
                                        <td>Povidone iodin (60 ml)</td>
                                        <td><%= laporan.povidone %></td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">18</td>
                                        <td>Alkohol 70%</td>
                                        <td><%= laporan.alkohol %></td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">19</td>
                                        <td>Buku panduan P3K</td>
                                        <td><%= laporan.bukuPanduan %></td>
                                        <td>1</td>
                                    </tr>
                                    
                                </tbody>
                            </table>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th
                                        colspan="3"
                                        class="
                                            text-start text-uppercase
                                            fw-bolder
                                            fs-5
                                        "
                                        >
                                            Dokumentasi saat Inspeksi
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="align-middle">
                                        <% let lokasi %> 
                                        <% if (laporan.jenisTurunan === "Tipe C") { %>
                                            <% lokasi = "pelaporanKotakP3kC" %> 
                                        <% } else { %>  
                                            <% lokasi = "pelaporanKotakP3kB" %> 
                                        <% } %> 
                                        <td style="width: 33%;">
                                            <img src="/img/dokumentasiInspeksi/<%= lokasi %>/<%= laporan.dokumentasi[0] %>" alt="" class="img-fluid">
                                        </td>
                                        <td style="width: 33%;">
                                            <img src="/img/dokumentasiInspeksi/<%= lokasi %>/<%= laporan.dokumentasi[1] %>" alt="" class="img-fluid">
                                        </td>
                                        <td style="width: 33%;">
                                            <img src="/img/dokumentasiInspeksi/<%= lokasi %>/<%= laporan.dokumentasi[2] %>" alt="" class="img-fluid">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                  </div>
                </div>
              </div>
              <button
                data-bs-toggle="modal"
                data-bs-target="#data<%= laporan._id %>"
                class="btn btn-primary"
              >
                Data
              </button>
            </td>
            <td><%= laporan.lokasiP3k %></td>
            <td><%= laporan.jenisTurunan %></td>
            <td><%= laporan.inspektor.nama %></td>
            <td class="text-center">
              <button class="btn btn-primary py-2 px-3">
                <i class="far fa-edit fs-5"></i>
              </button>
              <form
                action="/upik3/data-laporan-kotak-p3k?_method=DELETE"
                method="POST"
                class="d-inline-block"
              >
                <input
                  class="d-none"
                  type="text"
                  name="idLaporan"
                  readonly
                  value="<%= laporan._id %>"
                />
                <button type="submit" class="btn btn-danger py-2 px-3">
                  <i class="far fa-trash-alt fs-5"></i>
                </button>
              </form>
              <button class="btn btn-secondary py-2 px-3">
                <i class="fas fa-file-download fs-5"></i>
              </button>
            </td>
            <td class="text-center">
              <form action="/upik3/data-laporan-kotak-p3k?_method=PUT"
              method="POST"
              class="d-inline-block"
              >
                <input
                  class="d-none"
                  type="text"
                  readonly
                  name="idLaporan"
                  value="<%= laporan._id %>"
                />
                
                <button type="<%= !laporan.validasi.status && (currentUser.lokasi === laporan.lokasiP3k || currentUser.lokasi === "semua") ? "submit" : "button" %>" class="btn <%= laporan.validasi.status ? "btn-success" : "btn-danger" %>">
                  <%= laporan.validasi.status ? `Approved By ${laporan.validasi.user.nama}` : "Not Approved" %> 
                </button>
              </form>
            </td>
          </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>
<%- include("templateP3k/footer") %>
